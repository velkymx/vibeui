import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import VibeFormWysiwyg from '../../src/components/VibeFormWysiwyg.vue'

// Skip these tests since Quill is an optional peer dependency
// The component will display an error message when Quill is not installed
describe.skip('VibeFormWysiwyg', () => {
  it('renders wysiwyg with correct structure', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'test-wysiwyg'
      }
    })

    expect(wrapper.find('.vibe-wysiwyg-container').exists()).toBe(true)
  })

  it('renders label when provided', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        label: 'Content'
      }
    })

    const label = wrapper.find('label')
    expect(label.exists()).toBe(true)
    expect(label.text()).toContain('Content')
    expect(label.attributes('for')).toBe('editor')
  })

  it('shows required indicator', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        label: 'Content',
        required: true
      }
    })

    expect(wrapper.find('.text-danger').text()).toBe('*')
  })

  it('applies validation state classes to container', () => {
    const validWrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        validationState: 'valid'
      }
    })

    expect(validWrapper.find('.vibe-wysiwyg-container').classes()).toContain('is-valid')

    const invalidWrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        validationState: 'invalid'
      }
    })

    expect(invalidWrapper.find('.vibe-wysiwyg-container').classes()).toContain('is-invalid')
  })

  it('applies disabled class to container', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        disabled: true
      }
    })

    expect(wrapper.find('.vibe-wysiwyg-container').classes()).toContain('disabled')
  })

  it('sets custom height style', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        height: '400px'
      }
    })

    expect(wrapper.find('.vibe-wysiwyg-container').attributes('style')).toContain('min-height: 400px')
  })

  it('renders help text', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        helpText: 'Rich text editor'
      }
    })

    expect(wrapper.find('.form-text').text()).toBe('Rich text editor')
  })

  it('renders validation messages', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        validationState: 'invalid',
        validationMessage: 'Content is required'
      }
    })

    expect(wrapper.find('.invalid-feedback').text()).toBe('Content is required')
  })

  it('uses default placeholder', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor'
      }
    })

    // Placeholder is passed to Quill config, not directly visible in HTML
    expect(wrapper.props('placeholder')).toBe('Write something...')
  })

  it('uses custom placeholder', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        placeholder: 'Start typing...'
      }
    })

    expect(wrapper.props('placeholder')).toBe('Start typing...')
  })

  it('uses snow theme by default', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor'
      }
    })

    expect(wrapper.props('theme')).toBe('snow')
  })

  it('supports bubble theme', () => {
    const wrapper = mount(VibeFormWysiwyg, {
      props: {
        id: 'editor',
        theme: 'bubble'
      }
    })

    expect(wrapper.props('theme')).toBe('bubble')
  })
})
